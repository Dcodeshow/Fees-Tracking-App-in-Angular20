<div class="container-fluid py-4">
  <!-- Header -->
  <div class="text-center mb-4">
    <h3 class="fw-bold text-primary">
      <i class="bi bi-bank"></i> Institute Fees Management System
    </h3>
    <p class="text-muted">Track and manage student fee payments efficiently</p>
  </div>

  <!-- Summary Cards -->
  <div class="row text-center mb-4">
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h6 class="text-secondary"><i class="bi bi-people"></i> TOTAL Batches</h6>
          <h3 class="fw-bold text-primary">{{ dashboardData?.totalbatches }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h6 class="text-secondary">
            <i class="bi bi-check-circle-fill text-success"></i> Total Received
          </h6>
          <h3 class="fw-bold text-success">{{ dashboardData?.totalreceived }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h6 class="text-secondary">
            <i class="bi bi-hourglass-split text-warning"></i> Total Pending
          </h6>
          <h3 class="fw-bold text-warning">{{ dashboardData?.totalpending }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h6 class="text-secondary">
            <i class="bi bi-x-circle-fill text-danger"></i> Total Amount To Be Received
          </h6>
          <h3 class="fw-bold text-danger">
            {{ dashboardData?.totalamounttobereceived }}
          </h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Student Enrollments -->
  <div class="card shadow-sm border-0 rounded-3">
    <div
      class="card-header bg-primary text-white d-flex justify-content-between align-items-center px-4 py-3"
    >
      <h5 class="mb-0"><i class="bi bi-journal-text"></i> Student Enrollments</h5>
      <button class="btn btn-light btn-sm fw-semibold" (click)="openNewEnrollmentDialog()">
        <i class="bi bi-plus-circle"></i> New Enrollment
      </button>
    </div>

    <div class="card-body p-4">
      <!-- Search & Filter -->
      <div class="row mb-3">
        <div class="col-md-8">
          <input
            type="text"
            class="form-control"
            (keyup)="applyFilter($event)"
            placeholder="Search by student name..."
          />
        </div>
        <div class="col-md-4">
          <select class="form-select" (change)="applyFilter($event)">
            <option value="All Status">All Status</option>
            <option value="Full Paid">Full Paid</option>
            <option value="Partial Paid">Partial Paid</option>
            <option value="Not Paid">Not Paid</option>
          </select>
        </div>
        <div class="col-md-12 mt-3">
          <div class="mat-elevation-z8">
            <table mat-table [dataSource]="dataSource" matSort>
              <ng-container matColumnDef="enrollmentId">
                <th mat-header-cell *matHeaderCellDef>Enrollment ID</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.enrollmentId }}
                </td>
              </ng-container>

              <ng-container matColumnDef="srNo">
                <th mat-header-cell *matHeaderCellDef>Sr No</th>
                <td mat-cell *matCellDef="let element; let i = index">
                  {{ i + 1 + paginator.pageIndex * paginator.pageSize }}
                </td>
              </ng-container>

              <!-- Position Column -->
              <ng-container matColumnDef="batchName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Batch Name</th>
                <td mat-cell *matCellDef="let element">{{ element.batchName }}</td>
              </ng-container>

              <!-- Name Column -->
              <ng-container matColumnDef="studentName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
                <td mat-cell *matCellDef="let element">{{ element.studentName }}</td>
              </ng-container>

              <!-- Weight Column -->
              <ng-container matColumnDef="totalFees">
                <th mat-header-cell *matHeaderCellDef>Total Fees</th>
                <td mat-cell *matCellDef="let element">{{ element.totalFees }}</td>
              </ng-container>

              <!-- Symbol Column -->
              <ng-container matColumnDef="emi1">
                <th mat-header-cell *matHeaderCellDef>EMI 1</th>
                <td mat-cell *matCellDef="let element">{{ element.emi1 }}</td>
              </ng-container>

              <!-- Symbol Column -->
              <ng-container matColumnDef="emi2">
                <th mat-header-cell *matHeaderCellDef>EMI 2</th>
                <td mat-cell *matCellDef="let element">{{ element.emi2 }}</td>
              </ng-container>

              <!-- Symbol Column -->
              <ng-container matColumnDef="emi3">
                <th mat-header-cell *matHeaderCellDef>EMI 3</th>
                <td mat-cell *matCellDef="let element">{{ element.emi3 }}</td>
              </ng-container>

              <!-- Symbol Column -->
              <ng-container matColumnDef="totalReceived">
                <th mat-header-cell *matHeaderCellDef>Total Received</th>
                <td mat-cell *matCellDef="let element">{{ element.totalReceived }}</td>
              </ng-container>

              <!-- Symbol Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let element">
                  <span class="btn btn-sm text-white d-block" [appStatusColor]="element.status">
                    {{ element.status }}</span
                  >
                </td>
              </ng-container>

              <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef>Action</th>
                <td mat-cell *matCellDef="let element">
                  <button
                    class="btn btn-outline-primary btn-sm me-2"
                    (click)="openDeletePopup(element)"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                  <button class="btn btn-outline-warning btn-sm" (click)="onEdit(element)">
                    <i class="bi bi-pencil"></i>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>

            <mat-paginator
              [pageSizeOptions]="[5, 10, 20]"
              showFirstLastButtons
              aria-label="Select page of periodic elements"
            >
            </mat-paginator>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- DELETE CONFIRMATION POPUP -->
<ng-template #deleteDialog>
  <h2 mat-dialog-title>Confirm Delete</h2>

  <mat-dialog-content> Are you sure you want to delete this record? </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>No</button>
    <button mat-raised-button color="warn" (click)="onDelete()">Yes, Delete</button>
  </mat-dialog-actions>
</ng-template>
